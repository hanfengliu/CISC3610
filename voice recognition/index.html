<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <title>Voice Recognition</title>
    <style>
      canvas {
        border: 1px solid black;
        width: 800px;
        height: 600px;
      }
    </style>
  </head>
  <body class="container">
    <section class="mt-3">
      <h1>Instructions</h1>
      <ul class="list-unstyled">
        <li class="list-item">
          Say a name of the object to see the object on the screen
        </li>
        <ul class="list mb-3">
          <li>1. Dog</li>
          <li>2. Cat</li>
          <li>3. Cow</li>
          <li>4. Dolphin</li>
          <li>5. Sheep</li>
        </ul>
        <li>Say "Help" if you need assistance.</li>
        <li>Say "About" to hear about the program.</li>
      </ul>
    </section>
    <section>
      <button class="btn btn-primary btn-block mb-3" type="button" id="button">
        Speak
      </button>
      <div>
        <canvas id="canvas">
          <output name="result" for="canvas"></output>
        </canvas>
      </div>
    </section>

    <script>
      var canvas = document.getElementById("canvas");
      var ctx = canvas.getContext("2d");
      const image = new Image();
      const startBtn = document.querySelector("#button");

      var recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = "en-US";
      recognition.maxAlternatives = 1;

      var grammar =
        "#JSGF V1.0; grammar animal; public <animal> = dog | cat | cow | dolphin | sheep | help | about;";
      var SpeechGrammarList = new webkitSpeechGrammarList();
      SpeechGrammarList.addFromString(grammar, 1);
      recognition.grammars = SpeechGrammarList;

      startBtn.addEventListener("click", () => {
        console.log("here");
        if (startBtn.textContent === "Speak") {
          console.log("stop");
          startBtn.textContent = "Stop";

          recognition.stop();
        } else {
          console.log("start");
          startBtn.textContent = "Speak";
          recognition.start();
        }
      });

      const synth = window.speechSynthesis;

      recognition.onresult = (e) => {
        const transcript = e.results[0][0].transcript;
        if (transcript === "help") {
          console.log("help is being called");
          recognition.stop();
          startBtn.textContent = "Stop";

          const utter = new SpeechSynthesisUtterance(
            "Say a name of the object on the screen. Say about, to hear about the program."
          );
          synth.speak(utter);
        } else if (transcript === "about") {
          console.log("about is being called");
          recognition.stop();
          startBtn.textContent = "Stop";

          const utter2 = new SpeechSynthesisUtterance(
            "Author by Hanfeng Liu, Copyright:2022"
          );
          synth.speak(utter2);
        } else if (transcript === "dog") {
          console.log("dog is being called");
          recognition.stop();
          startBtn.textContent = "Stop";

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          image.src = "img/dog.jpg";
          image.onload = function () {
            canvas.width = this.naturalWidth;
            canvas.height = this.naturalHeight;
            ctx.drawImage(image, 0, 0);
          };
        } else if (transcript === "cat") {
          console.log("cat is being called");
          recognition.stop();
          startBtn.textContent = "Stop";

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          image.src = "img/cat.jpg";
          image.onload = function () {
            canvas.width = this.naturalWidth;
            canvas.height = this.naturalHeight;
            ctx.drawImage(image, 0, 0);
          };
        } else if (transcript === "cow") {
          console.log("cow is being called");
          recognition.stop();
          startBtn.textContent = "Stop";

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          image.src = "img/cow.jpg";
          image.onload = function () {
            canvas.width = this.naturalWidth;
            canvas.height = this.naturalHeight;
            ctx.drawImage(image, 0, 0);
          };
        } else if (transcript === "dolphin") {
          console.log("dolphin is being called");
          recognition.stop();
          startBtn.textContent = "Stop";

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          image.src = "img/dolphin.jpg";
          image.onload = function () {
            canvas.width = this.naturalWidth;
            canvas.height = this.naturalHeight;
            ctx.drawImage(image, 0, 0);
          };
        } else if (transcript === "sheep") {
          console.log("sheep is being called");
          recognition.stop();
          startBtn.textContent = "Stop";
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          image.src = "img/sheep.jpg";
          image.onload = function () {
            canvas.width = this.naturalWidth;
            canvas.height = this.naturalHeight;
            ctx.drawImage(image, 0, 0);
          };
        } else {
          console.log("not  recognize");
          recognition.stop();
          startBtn.textContent = "Stop";

          const utter3 = new SpeechSynthesisUtterance(
            "Not  recognize and please try again."
          );
          synth.speak(utter3);
        }
      };
    </script>
  </body>
</html>
